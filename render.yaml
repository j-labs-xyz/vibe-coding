databases:
  # --------------------------------------------------------------------------------
  # Database (Postgres)
  # --------------------------------------------------------------------------------
  - name: vastlink-db
    databaseName: vibe_db
    user: vibe_user
    plan: free # Change to starter/standard for production

services:
  # --------------------------------------------------------------------------------
  # Redis
  # --------------------------------------------------------------------------------
  - type: redis
    name: vastlink-redis
    plan: free # Change to starter/standard for production
    ipAllowList: [] # Allow all internal

  # --------------------------------------------------------------------------------
  # API Service
  # --------------------------------------------------------------------------------
  - type: web
    name: vastlink-api
    env: docker
    dockerfilePath: ./apps/api/Dockerfile
    plan: free
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: vastlink-db
          property: connectionString
      - key: REDIS_HOST
        fromService:
          type: redis
          name: vastlink-redis
          property: host
      - key: REDIS_PORT
        fromService:
          type: redis
          name: vastlink-redis
          property: port
      - key: NODE_ENV
        value: production

  # --------------------------------------------------------------------------------
  # Web Service
  # --------------------------------------------------------------------------------
  - type: web
    name: vastlink-web
    env: docker
    dockerfilePath: ./apps/web/Dockerfile
    plan: free
    envVars:
      - key: NEXT_PUBLIC_API_URL
        fromService:
          type: web
          name: vastlink-api
          envVarKey: RENDER_EXTERNAL_URL
      - key: NODE_ENV
        value: production
